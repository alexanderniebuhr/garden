---
import type { CollectionEntry } from "astro:content";
import { getAbsoluteLocaleUrlList } from "astro:i18n";
import Developing from "../components/icons/Developing.astro";
import Experimental from "../components/icons/Experimental.astro";
import Final from "../components/icons/Final.astro";
import Sharing from "../components/icons/Sharing.astro";
import Understanding from "../components/icons/Understanding.astro";
import Page from "./Page.astro";

type Post = CollectionEntry<"blog">["data"];
interface Props extends Post {
	pageTitle: string;
}
const { pageTitle, title } = Astro.props;
const description = `${title} — by ${Astro.props.author}`;

const absoluteLocaleUrlList = getAbsoluteLocaleUrlList(
	Astro.url.pathname.split("/").toSpliced(1, 1).join("/"),
	{},
);

const lang = Astro.currentLocale || "de";
const canonicalUrl = new URL(Astro.url.pathname, Astro.site);
---

<Page title={pageTitle} description={description}>
	<Fragment slot="head">
		<title>{title}</title>
		<meta name="description" content={description}>
		<link rel="canonical" href={canonicalUrl.href}>
		{absoluteLocaleUrlList.map((url) => {
				const locale = new URL(url).pathname.split("/").at(1);
				return <link rel="alternate" hreflang={locale} href={url} />;
			})}
		<!-- Open Graph -->
		<meta property="og:type" content="website">
		<meta property="og:url" content={canonicalUrl.href}>
		<meta property="og:title" content={title}>
		<meta property="og:description" content={description}>
		<meta property="og:locale" content={lang}>
		<meta property="og:site_name" content="Alexander Niebuhr's Garden">
		<!-- Twitter -->
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content={title}>
		<meta name="twitter:description" content={description}>
	</Fragment>
	<Fragment slot="main">
		<article class="flex flex-col gap-fluid-m">
			<header class="flex flex-col items-center gap-fluid-xs">
				<time
					class="text-sm text-neutral-500 dark:text-neutral-400"
					datetime={Astro.props.date.toISOString()}
				>
					{Astro.props.date.toLocaleDateString("de-DE")}
				</time>
				<h1 class="text-fluid-heading font-bold text-center">{title}</h1>
				<div
					role="group"
					aria-label="Post maturity stages"
					class="flex flex-wrap items-center justify-center gap-1 select-none"
				>
					<button
						class="inline-flex cursor-help rounded-sm p-0.5 outline-none focus-visible:outline-2 focus-visible:outline-solid focus-visible:outline-neutral-400 focus-visible:outline-offset-2"
						style="anchor-name: --stage-experimental"
						popovertarget="tip-experimental"
					>
						<Experimental type="multi" width="2rem" height="2rem" />
					</button>
					<div
						id="tip-experimental"
						popover
						class="fixed [position-area:block-end] m-0 w-max max-w-56 px-3 py-2 border border-neutral-200 rounded-lg bg-white text-neutral-700 text-[0.8125rem] leading-[1.4] shadow-[0_4px_12px_rgb(0_0_0/0.08)] opacity-0 -translate-y-1 [transition:opacity_150ms_ease,translate_150ms_ease,overlay_150ms_ease_allow-discrete,display_150ms_ease_allow-discrete] open:opacity-100 open:translate-y-1 starting:open:opacity-0 starting:open:-translate-y-1 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:shadow-[0_4px_12px_rgb(0_0_0/0.3)] [&_strong]:block [&_strong]:font-semibold [&_strong]:text-neutral-900 [&_strong]:mb-0.5 dark:[&_strong]:text-white [&_p]:m-0"
						style="position-anchor: --stage-experimental"
					>
						<strong>Experimental</strong>
						<p>Early seedling — a raw idea, just planted.</p>
					</div>
					&centerdot;
					<button
						class="inline-flex cursor-help rounded-sm p-0.5 outline-none focus-visible:outline-2 focus-visible:outline-solid focus-visible:outline-neutral-400 focus-visible:outline-offset-2"
						style="anchor-name: --stage-developing"
						popovertarget="tip-developing"
					>
						<Developing
							type="multi"
							width="2rem"
							height="2rem"
							class="grayscale"
						/>
					</button>
					<div
						id="tip-developing"
						popover
						class="fixed [position-area:block-end] m-0 w-max max-w-56 px-3 py-2 border border-neutral-200 rounded-lg bg-white text-neutral-700 text-[0.8125rem] leading-[1.4] shadow-[0_4px_12px_rgb(0_0_0/0.08)] opacity-0 -translate-y-1 [transition:opacity_150ms_ease,translate_150ms_ease,overlay_150ms_ease_allow-discrete,display_150ms_ease_allow-discrete] open:opacity-100 open:translate-y-1 starting:open:opacity-0 starting:open:-translate-y-1 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:shadow-[0_4px_12px_rgb(0_0_0/0.3)] [&_strong]:block [&_strong]:font-semibold [&_strong]:text-neutral-900 [&_strong]:mb-0.5 dark:[&_strong]:text-white [&_p]:m-0"
						style="position-anchor: --stage-developing"
					>
						<strong>Developing</strong>
						<p>Growing — being actively worked on.</p>
					</div>
					&centerdot;
					<button
						class="inline-flex cursor-help rounded-sm p-0.5 outline-none focus-visible:outline-2 focus-visible:outline-solid focus-visible:outline-neutral-400 focus-visible:outline-offset-2"
						style="anchor-name: --stage-understanding"
						popovertarget="tip-understanding"
					>
						<Understanding
							type="multi"
							width="2rem"
							height="2rem"
							class="grayscale"
						/>
					</button>
					<div
						id="tip-understanding"
						popover
						class="fixed [position-area:block-end] m-0 w-max max-w-56 px-3 py-2 border border-neutral-200 rounded-lg bg-white text-neutral-700 text-[0.8125rem] leading-[1.4] shadow-[0_4px_12px_rgb(0_0_0/0.08)] opacity-0 -translate-y-1 [transition:opacity_150ms_ease,translate_150ms_ease,overlay_150ms_ease_allow-discrete,display_150ms_ease_allow-discrete] open:opacity-100 open:translate-y-1 starting:open:opacity-0 starting:open:-translate-y-1 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:shadow-[0_4px_12px_rgb(0_0_0/0.3)] [&_strong]:block [&_strong]:font-semibold [&_strong]:text-neutral-900 [&_strong]:mb-0.5 dark:[&_strong]:text-white [&_p]:m-0"
						style="position-anchor: --stage-understanding"
					>
						<strong>Understanding</strong>
						<p>Maturing — deepening insight on the topic.</p>
					</div>
					&centerdot;
					<button
						class="inline-flex cursor-help rounded-sm p-0.5 outline-none focus-visible:outline-2 focus-visible:outline-solid focus-visible:outline-neutral-400 focus-visible:outline-offset-2"
						style="anchor-name: --stage-sharing"
						popovertarget="tip-sharing"
					>
						<Sharing
							type="multi"
							width="2rem"
							height="2rem"
							class="grayscale"
						/>
					</button>
					<div
						id="tip-sharing"
						popover
						class="fixed [position-area:block-end] m-0 w-max max-w-56 px-3 py-2 border border-neutral-200 rounded-lg bg-white text-neutral-700 text-[0.8125rem] leading-[1.4] shadow-[0_4px_12px_rgb(0_0_0/0.08)] opacity-0 -translate-y-1 [transition:opacity_150ms_ease,translate_150ms_ease,overlay_150ms_ease_allow-discrete,display_150ms_ease_allow-discrete] open:opacity-100 open:translate-y-1 starting:open:opacity-0 starting:open:-translate-y-1 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:shadow-[0_4px_12px_rgb(0_0_0/0.3)] [&_strong]:block [&_strong]:font-semibold [&_strong]:text-neutral-900 [&_strong]:mb-0.5 dark:[&_strong]:text-white [&_p]:m-0"
						style="position-anchor: --stage-sharing"
					>
						<strong>Sharing</strong>
						<p>Ready to share — polished enough for others.</p>
					</div>
					&centerdot;
					<button
						class="inline-flex cursor-help rounded-sm p-0.5 outline-none focus-visible:outline-2 focus-visible:outline-solid focus-visible:outline-neutral-400 focus-visible:outline-offset-2"
						style="anchor-name: --stage-final"
						popovertarget="tip-final"
					>
						<Final type="multi" width="2rem" height="2rem" class="grayscale" />
					</button>
					<div
						id="tip-final"
						popover
						class="fixed [position-area:block-end] m-0 w-max max-w-56 px-3 py-2 border border-neutral-200 rounded-lg bg-white text-neutral-700 text-[0.8125rem] leading-[1.4] shadow-[0_4px_12px_rgb(0_0_0/0.08)] opacity-0 -translate-y-1 [transition:opacity_150ms_ease,translate_150ms_ease,overlay_150ms_ease_allow-discrete,display_150ms_ease_allow-discrete] open:opacity-100 open:translate-y-1 starting:open:opacity-0 starting:open:-translate-y-1 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-200 dark:shadow-[0_4px_12px_rgb(0_0_0/0.3)] [&_strong]:block [&_strong]:font-semibold [&_strong]:text-neutral-900 [&_strong]:mb-0.5 dark:[&_strong]:text-white [&_p]:m-0"
						style="position-anchor: --stage-final"
					>
						<strong>Final</strong>
						<p>Evergreen — considered complete.</p>
					</div>
				</div>
			</header>
			<div class="prose max-w-none">
				<slot />
			</div>
		</article>
	</Fragment>
</Page>
